{% extends "base.html" %}

{% block title %}Messages{% endblock %}

{% block content %}
<div id="messages">
    <h2>Messages with {{ recipient.username or recipient.email }}</h2>
    <ul class="chat-list">
        {% for msg in messages %}
            <li class="{% if msg.sender_id == recipient.id %}chat-left{% else %}chat-right{% endif %}">
                <strong>
                {% if msg.sender_id == recipient.id %}
                    {{ recipient.username or recipient.email }}:
                {% else %}
                    You:
                {% endif %}
                </strong>
                {{ msg.content }}
                <span class="msg-time" data-iso-time="{{ msg.timestamp.isoformat() }}Z"></span>
            </li>
        {% endfor %}
    </ul>
    <form method="post">
        <input type="text" name="content" placeholder="Type a message" required>
        <button type="submit">Send</button>
    </form>
</div>

<script>
document.querySelectorAll('.msg-time').forEach(function(span) {
    const dateString = span.getAttribute('data-iso-time');
    if (dateString) {
        const date = new Date(dateString);
        // Format: MM/DD/YYYY, HH:MM AM/PM in local time
        const formatted = date.toLocaleString(undefined, {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            hour12: true
        });
        span.textContent = formatted;
    }
});
</script>
{% endblock %}
