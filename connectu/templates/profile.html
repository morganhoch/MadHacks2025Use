{% extends "base.html" %}

{% block title %}Profile - ConnectU{% endblock %}

{% block content %}
<div class="profile-container">
    <div class="profile-header">
        <div class="avatar">
            <img src="{{ user.avatar_url or url_for('static', filename='default-avatar.png') }}" alt="Avatar">
        </div>
        <div class="profile-info">
            <h2>{{ user.username }}</h2>
            <p>{{ user.email }}</p>
        </div>
    </div>

    <div class="profile-details">
        <h3>Bio</h3>
        <p>{{ user.bio or "No bio yet." }}</p>

        <h3>Subjects</h3>
        <p>{{ user.subjects or "No subjects added yet." }}</p>
    </div>

    <div class="profile-actions">
        <a href="{{ url_for('edit_profile') }}" class="btn-primary">Edit Profile</a>
        <a href="{{ url_for('inbox') }}" class="btn-secondary">Message Me</a>
    </div>

    <!-- Joined Classes -->
    <div class="profile-classes">
        <h3>Joined Classes</h3>
        {% if user_courses %}
            <ul>
            {% for c in user_courses %}
                <li>
                    <a href="{{ url_for('course_detail', course_code=c.course_code) }}">
                        {{ c.course_code }} - {{ c.title }}
                    </a>
                </li>
            {% endfor %}
            </ul>
        {% else %}
            <p>You haven't joined any classes yet.</p>
        {% endif %}
    </div>

    <!-- Friends list -->
    <div class="profile-friends">
        <h3>Friends</h3>
        {% if friends %}
            <ul>
            {% for f in friends %}
                <li>
                    <a href="{{ url_for('messaging.direct_message', recipient_id=f.id) }}">
                        {{ f.username }}
                    </a>
                </li>
            {% endfor %}
            </ul>
        {% else %}
            <p>You have no friends yet.</p>
        {% endif %}
    </div>

    <!-- Pending friend requests -->
    <div class="profile-requests">
        <h3>Pending Friend Requests</h3>
        {% if pending_requests %}
            <ul>
            {% for fr in pending_requests %}
                <li>
                    {{ fr.requester.username }}
                    <form action="{{ url_for('messaging.respond_friend', friendship_id=fr.id, action='accept') }}" method="post" style="display:inline;">
                        <button type="submit" class="btn-primary btn-sm">Accept</button>
                    </form>
                    <form action="{{ url_for('messaging.respond_friend', friendship_id=fr.id, action='deny') }}" method="post" style="display:inline;">
                        <button type="submit" class="btn-secondary btn-sm">Deny</button>
                    </form>
                </li>
            {% endfor %}
            </ul>
        {% else %}
            <p>No pending friend requests.</p>
        {% endif %}
    </div>

    <!-- Add Friends Section -->
    <div class="profile-add-friends">
        <h3>Add Friends</h3>
        {% if potential_friends %}
            <ul>
            {% for pf in potential_friends %}
                <li>
                    {{ pf.username }}
                    <form action="{{ url_for('messaging.add_friend', user_id=pf.id) }}" method="post" style="display:inline;">
                        <button type="submit" class="btn-primary btn-sm">Send Friend Request</button>
                    </form>
                </li>
            {% endfor %}
            </ul>
        {% else %}
            <p>No users available to add.</p>
        {% endif %}
    </div>
</div>
{% endblock %}

