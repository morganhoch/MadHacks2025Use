{% extends "base.html" %}

{% block title %}{{ course.course_code }} - ConnectU{% endblock %}

{% block content %}
<div class="course-container">
    <h1>{{ course.course_code }} - {{ course.title }}</h1>

    {% if course.description %}
        <p>{{ course.description }}</p>
    {% endif %}

    {% if user in course.students %}
    <form action="{{ url_for('leave_course', course_id=course.id) }}" method="post" style="display:inline;">
        <button type="submit" class="btn btn-danger">Leave Course</button>
    </form>
    {% endif %}

    <h2>Users in this course</h2>
    {% if enrolled_users %}
        <ul class="course-users">
        {% for u in enrolled_users %}
            <li>
                <a href="{{ url_for('profile_view', user_id=u.id) }}">{{ u.username }}</a>
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p>No one has joined this course yet.</p>
    {% endif %}

    <hr>
    <h2>Ask a Question</h2>
    {% if session.user %}
        <form method="POST">
            <textarea name="content" placeholder="Type your question here..." required></textarea>
            <button type="submit" name="question">Post Question</button>
        </form>
    {% else %}
        <p><a href="{{ url_for('login') }}">Log in</a> to ask a question.</p>
    {% endif %}

    <h2>Questions & Answers</h2>
    {% if questions %}
        {% for q in questions %}
            <div class="question-block">
                <p><strong>{{ q.user.username }}</strong> asked:</p>
                <p>{{ q.content }}</p>

                <ul>
                {% for a in q.answers %}
                    <li><strong>{{ a.user.username }}</strong> answered: {{ a.content }}</li>
                {% endfor %}
                </ul>

                {% if session.user %}
                    <form method="POST">
                        <textarea name="content" placeholder="Type your answer here..." required></textarea>
                        <input type="hidden" name="question_id" value="{{ q.id }}">
                        <button type="submit" name="answer">Post Answer</button>
                    </form>
                {% endif %}
            </div>
        {% endfor %}
    {% else %}
        <p>No questions yet. Be the first to ask!</p>
    {% endif %}
</div>
{% endblock %}
